
@{
    ViewBag.Title = "Add New (Posts)";
    ViewBag.alertSize = "160px";
}

<style>
    .custom-img {
        width: 20px;
        height: 20px;
    }
    .top-container {
        margin: 2%;
        margin-top: 0;
        width:100%;
    }
    .editor-options {
        margin: 2%;
        margin-top:0;
    }
    .editor-options td {
        padding: 3px 10px;
        border-radius: 5px;
    }
    .editor-options td:hover {
        background-color: lightgray;
    }
    #editor{
        border: 1px solid gray;
        margin:2%;
        width:96%;
        min-height:500px;
    }
    #title {
        border: 0px;
        border-bottom: 1px solid lightgray;
        margin: 2%;
        font-size: 40px;
        min-width: 96%;
        
    }
    .Custom-Button {
        padding: 5px 10px;
    }
    table {
        text-align: center;
    }
</style>
<script>
    var boldStatus = false;
    var italicStatus = false;
    var underlineStatus = false;
    var unOrderedListStatus = false;
    var orderedListStatus = false;
    var editor;
    var uploadId = '@ViewBag.post.postId';

    window.onload = function () {
        setEditable();
    };

    function setEditable() {
        editor = document.getElementById("editor");
        editor.contentWindow.document.designMode = "on";
        editor.focus();
    }

    function bold() {
        var bold = document.getElementById("bold");
        editor.contentWindow.document.execCommand("bold", false, "");
        if (!boldStatus) {
            bold.style.backgroundColor = "lightgray";
            boldStatus = true;
        } else {
            bold.style.backgroundColor = "";
            boldStatus = false;
        }
    }
    function italic() {
        var italic = document.getElementById("italic");
        editor.contentWindow.document.execCommand("italic", false, "");
        if (!italicStatus) {
            italic.style.backgroundColor = "lightgray";
            italicStatus = true;
        } else {
            italic.style.backgroundColor = "";
            italicStatus = false;
        }
    }
    function underline() {
        var underline = document.getElementById("underline");
        editor.contentWindow.document.execCommand("underline", false, "");
        if (!underlineStatus) {
            underline.style.backgroundColor = "lightgray";
            underlineStatus = true;
        } else {
            underline.style.backgroundColor = "";
            underlineStatus = false;
        }
    }
    function unOrderedList() {
        var unOrderedList = document.getElementById("unOrderedList");
        editor.contentWindow.document.execCommand("insertUnorderedList", false, "");
        if (!unOrderedListStatus) {
            unOrderedList.style.backgroundColor = "lightgray";
            unOrderedListStatus = true;
        } else {
            unOrderedList.style.backgroundColor = "";
            unOrderedListStatus = false;
        }
    }
    function orderedList() {
        var orderedList = document.getElementById("orderedList");
        editor.contentWindow.document.execCommand("insertorderedList", false, "");
        if (!orderedListStatus) {
            orderedList.style.backgroundColor = "lightgray";
            orderedListStatus = true;
        } else {
            orderedList.style.backgroundColor = "";
            orderedListStatus = false;
        }
    }
    function leftAlign() {
        editor.contentWindow.document.execCommand("justifyLeft", false, "");
    }
    function centerAlign() {
        editor.contentWindow.document.execCommand("justifyCenter", false, "");
    }
    function indent() {
        editor.contentWindow.document.execCommand("indent", false, "");
    }
    function fontColor(color) {
        editor.contentWindow.document.execCommand("foreColor", false, color);
    }

    function fontSize(size) {
        //var bool;
        if (size != 0) {
            editor.contentWindow.document.execCommand("fontSize", false, size);
        } else {
            editor.contentWindow.document.execCommand("fontSize", false, "3");
        }
    }
    
    function uploadPost(val) {
        var title = document.getElementById("title").value;
        if (title != "") {
            var category = document.getElementById("post-category").value;

            if (val == "Save as Draft") {
                val = "Draft";
            }
            var data = JSON.stringify({
                'status': val,
                'content': editor.contentWindow.document.body.innerHTML.toString(),
                'title': title,
                'category': category,
                'uploadId': uploadId
            });
            $.ajax({
                type: "POST",
                url: "/Post/uploadPost", // the URL of the controller action method
                data: data,
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (result) {
                    document.getElementsByClassName("alert")[0].style.display = "block";
                    if (uploadId != 0) {
                        document.getElementsByClassName("alert-message")[0].innerHTML = "Post Updated Successfully!";
                    } else {
                        if (val == "Draft") {
                            document.getElementsByClassName("alert-message")[0].innerHTML = "Post Save As Draft Successfully!";
                        } else {
                            document.getElementsByClassName("alert-message")[0].innerHTML = "Post Published Successfully!";
                        }
                    }
                    uploadId = result.postID;
                },
                error: function () {
                    //alert("error");
                    document.getElementsByClassName("alert")[0].style.display = "block";
                    if (uploadId != 0) {
                        document.getElementsByClassName("alert-message")[0].innerHTML = "Post Updat Un-Successful!";
                    } else {
                        if (val == "Draft") {
                            document.getElementsByClassName("alert-message")[0].innerHTML = "Post Save As Draft Un-Successful!";
                        } else {
                            document.getElementsByClassName("alert-message")[0].innerHTML = "Post Publish Un-Successful!";
                        }
                    }
                }
            });
        } else {
            document.getElementsByClassName("alert")[0].style.display = "block";
            document.getElementsByClassName("alert-message")[0].innerHTML = "Please enter title!";
        }
    }
    
</script>

<div style="margin-left:160px" onload="setEditable()">
    <h2>Add New</h2>
    <hr />
    <div>
        <div>
            <table class="top-container">
                <tr>
                    <td>
                        <input class="Custom-Button" type="button" value="Save as Draft" onclick="uploadPost(this.value)" />
                        <input class="Custom-Button" type="button" value="Publish" onclick="uploadPost(this.value)" />
                    </td>
                </tr>
                <tr style="float:left;">
                    <td>
                        <label style="font-size:15px">Category : </label>
                    </td>
                    <td>
                        <select id="post-category" class="Custom-Button img-selection" style="background-color:white; color:black;">
                            @foreach (var cat in ViewBag.catList)
                            {
                                if (ViewBag.post.catId == @cat.catID)
                                {
                                    <option value="@cat.catID" selected>@cat.title</option>
                                }
                                else
                                {
                                    <option value="@cat.catID">@cat.title</option>
                                }

                            }
                        </select>
                    </td>
                </tr>
            </table>

        </div>
        <div>
            <span>
                <input type="text" id="title" placeholder="Title" maxlength="150" value="@ViewBag.post.postTitle" />
            </span>
        </div>
        <div>
            <table cellpadding="2" class="editor-options" >
                <tr>
                    <td class="editor_icon" id="bold"><img class="custom-img" src="~/TextEditor_Icon/bold.png" onclick="bold();" /></td>
                    <td class="editor_icon" id="italic"><img class="custom-img" src="~/TextEditor_Icon/italic.png" onclick="italic();" /></td>
                    <td class="editor_icon" id="underline"><img class="custom-img" src="~/TextEditor_Icon/underline.png" onclick="underline();" /></td>
                    <td class="editor_icon" id="unOrderedList"><img class="custom-img" src="~/TextEditor_Icon/unOrderedList.png" onclick="unOrderedList();" /></td>
                    <td class="editor_icon" id="orderedList"><img class="custom-img" src="~/TextEditor_Icon/orderedList.png" onclick="orderedList();" /></td>
                    <td class="editor_icon" id="leftAlign"><img class="custom-img" src="~/TextEditor_Icon/left-align.png" onclick="leftAlign();" /></td>
                    <td class="editor_icon" id="centerAlign"><img class="custom-img" src="~/TextEditor_Icon/center-alignment.png" onclick="centerAlign();" /></td>
                    <td class="editor_icon" id="indent"><img class="custom-img" src="~/TextEditor_Icon/indent.png" onclick="indent();" /></td>
                    <td class="editor_icon" id="fontColor">
                        Font Color: <input type="color" id="color" value="#000002" onchange="fontColor(this.value);" />
                    </td>
                    <td class="editor_icon" id="fontSize">
                        Font Size: 
                        <select class="Custom-Button img-selection" style="float:none; background-color:white; color:black;"
                                onclick="fontSize(this.value)" id="font-size-selection">
                            <option value="0">Default</option>
                            <option value="7" style="font-size:3em">Header 1</option>
                            <option value="6" style="font-size:2em">Header 2</option>
                            <option value="5" style="font-size:1.5em">Header 3</option>
                            <option value="4" style="font-size:1.13em">Paragraph 1</option>
                            <option value="3" style="font-size:1.0em">Paragraph 2</option>
                            <option value="2" style="font-size:0.82em">Paragraph 3</option>
                            <option value="1" style="font-size:0.63em">Paragraph 4</option>
                        </select>
                    </td>
                    <td class="editor_icon">
                        <input class="Custom-Button" type="button" value="Insert Image" style="padding:2px 8px" id="insertImage" onclick="insertImage()" />
                    </td>
                </tr>
            </table>
        </div>
        <iframe id="editor" style="font-size:13px" srcdoc="@ViewBag.post.postData">
        </iframe>
    </div>
</div>
<div class="popup" style="display:@ViewBag.popup">
    <!-- Modal content -->
    <div class="popup-content">
        <span class="close">&times;</span>
        <div>
            <h3>Insert Image</h3>
            <hr />
            @if (ViewBag.DisplayImages != null)
            {
                <table style="width:100%">
                    @{
                        int totalCount = ViewBag.DisplayImages.Count;
                    }
                    @for (int row = 0; row < ViewBag.DisplayImages.Count; row++)
                    {
                        if (row % 3 == 0)
                        {
                            int maxIndex = row + 3;
                            if (maxIndex > totalCount)
                            {
                                maxIndex = totalCount;
                            }

                            <tr>
                                @for (int imageIndex = row; imageIndex < maxIndex; imageIndex++)
                                {
                                    <td class="image-container" onclick="imageClick(this)">
                                        @*<input type="text" name="id" hidden value="@ViewBag.DisplayImages[imageIndex].imageID" />*@
                                        <img src="@Url.Content(@ViewBag.DisplayImages[imageIndex].imgLoc)" width="150" height="150" />
                                        <br />
                                        <h5>@ViewBag.DisplayImages[imageIndex].title</h5>
                                        <table class="image-selection" style="visibility:hidden; width:100%">
                                            <tr>
                                                <td>
                                                    <select class="Custom-Button img-selection" style="float:none; background-color:white; color:black;">
                                                        <option value="thumb">Small</option>
                                                        <option value="medium">Medium</option>
                                                        <option value="large">Large</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <input type="button" value="Submit" class="Custom-Button" style="padding:2px 8px;
                                                        float:none;" onclick="addImage('@Url.Content(ViewBag.DisplayImages[imageIndex].imgLoc)',this)"/>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                }
                            </tr>
                        }
                    }
                </table>
                <div class="pagination">
                    @for (int page = 1; page <= ViewBag.LibraryProp.noOfPages; page++)
                    {
                        if (ViewBag.LibraryProp.currentPage == page)
                        {
                            @Html.ActionLink(page.ToString(), "nextImagePage"
                           , new { nextPage = page}, new { @class = "active" })
                        }
                        else
                        {
                            @Html.ActionLink(page.ToString(), "nextImagePage"
                           , new { nextPage = page})
                        }

                    }
                </div>
            }
            else
            {
                <div>
                    No Images found!
                </div>
            }
        </div>
    </div>
</div>

<script>
    // Get the modal
    var popup = document.getElementsByClassName('popup')[0];

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    function insertImage() {
        popup.style.display = "block";

    }
    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
        popup.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
        if (event.target == popup) {
            popup.style.display = "none";
        }
    }

    function imageClick(image) {
        var current = document.getElementsByClassName("image-container");
        for (var x = 0; x < current.length;x++) {
            current[x].style.backgroundColor = "";
            current[x].getElementsByClassName("image-selection")[0].style.visibility = "hidden";
        }
        image.style.backgroundColor = "#C0C0C0";
        image.getElementsByClassName("image-selection")[0].style.visibility = "visible";
    }

    function addImage(imageUrl,image) {
        var url = imageUrl.split('/');
        var filename = (url[url.length - 1]).split('.').slice(0, -1).join('.');
        var extension = (url[url.length - 1]).replace(filename, "");
        var size = image.parentNode.parentNode.getElementsByClassName("Custom-Button")[0].value;
        var file = filename + '_' + size + extension;
        var path = imageUrl.replace(filename + extension, "");
        //alert(path + file);

        editor.contentWindow.document.body.innerHTML += "<img style='padding:5px' src=\"" + (path + file) + "\" />";
        popup.style.display = "none";
    }
</script>

